# 지하철 노선도 미션
[ATDD 강의](https://edu.nextstep.camp/c/R89PYi5H) 실습을 위한 지하철 노선도 애플리케이션

### step 1 - 단위 테스트 작성
1. 지하철 구간 관련 단위 테스트 완성하기
   1. 구간 단위 테스트 (LineTest)
   2. 구간 서비스 단위 테스트 with Mock (LineServiceMockTest)
   3. 구간 서비스 단위 테스트 without Mock (LineServiceTest)
2. 단위 테스트를 기반으로 비즈니스 로직 리팩터링 하기
3. 비즈니스 로직 리팩터링
   1. 구간 추가/삭제 기능에 대한 비즈니스 로직은 현재 LineService 에 대부분 위치
      1. 비즈니스 로직을 도메인 클래스(Line)으로 옮기기
   2. 리팩터링 시 LineTest 의 테스트 메서드를 활용하여 `TDD 사이클`로 리팩터링을 진행
   3. 리팩터링 과정에서 Line 이외 추가적인 클래스가 생겨도 좋음
      1. 구간 관리에 대한 책임을 Line 외 별도의 도메인 객체가 가지게 할 수 있음
         1. Line 이 List 형태로 가지고 있던 Section 을 Sections 라는 일급 콜렉션을 이용하여 분리함
4. step 1 피드백 리스트
   1. StationService -> StationRepository 로 했을 때의 side effect
   2. request 객체에 valid 함수를 생성! -> 이 경우 Service 레이어에서 검증하는데 이렇게 하기 보다는 요청을 받는 순간 검증을 하도록! -> spring validation 사용
   3. 구간을 등록할 때 (구간 등록시) 요구 사항 준수!
   4. Sections 에서 예외 사항을 자세하게 분리하는 방식!
   5. Sections 에서 지하철 노선에 상행 종점역과 하행 종점역만 있는 경우에 대한 예외 처리가 없다.
   6. LineTest 에서 하드 코딩보다는 전역 상수로 선언해보자!
   7. LineTest 에서 예외 케이스에 대한 검증 테스트도 같이 해보자!

### step 2 - 지하철 구간 추가 리팩터링
0. step 1 피드백
   1. Sections 에서 이미 사용되고 있는 모든 역을 가져오는 allStations() 메서드를 활용하여 duplicateStation 을 구현!
1. 기능 요구사항
   1. 추가된 요구사항 기반으로 `지하철 구간 관리 기능`을 리팩터링
   2. 추가된 요구사항을 정의한 `인수 조건`을 도출
   3. 인수 조건을 검증하는 `인수 테스트`를 작성
   4. 예외 케이스에 대한 검증도 포함
2. 프로그래밍 요구사항
   1. **인수 테스트 주도 개발 프로세스**에 맞춰서 기능을 구현
      1. `인수 조건`을 정의
      2. `인수 조건`을 검증하는 `인수 테스트` 작성
      3. 인수 테스트를 충족하는 `기능 구현`
   2. 인수 조건은 `인수 테스트 메서드 상단에 주석`으로 작성
      1. `뼈대 코드`의 인수 테스트를 참고
   3. **`인수 테스트 이후 기능 구현은 TDD 로 진행`**
      1. 도메인 레이어 테스트는 필수 (순수 도메인 테스트)
      2. 서비스 레이어 테스트는 선택 (Mock or without Mock)
3. 요구사항 설명
   1. 구간 추가에 대한 스펙, 요구사항이 변경되었다!
   2. `역 사이에 새로운 역`을 등록할 경우
      1. 기존역 A-C (7m), 새로운 역 A-B (4m)
      2. 이 경우 A-B-C 가 되며
      3. 각 구간의 길이는 A-B (4m), B-C (3m) 가 된다.
      4. 기존 구간의 길이는 새로운 구간의 길이의 뺀 값으로 설정된다.
      5. ex) 기존역 A-C (7m), 새로운역 B-C (4m) 도 가능하다.
      6. `기존 구간의 상행역`과 `신규 노선의 상행역`이 일치할 경우 `역 사이에 새로운 역` 등록 case
      7. 마찬가지로 `기존 구간의 하행역`과 `신규 노선의 하행역`이 일치할 경우 `역 사이에 새로운 역` 등록 case
   3. `새로운 역을 상행 종점`으로 등록할 경우
      1. 기존역 A-C (7m), 새로운 역 B-A (4m)
      2. 이 경우 B-A-C 가 되며
      3. 각 구간의 길이는 B-A (4m), A-C (7m) 가 된다.
      4. `기존 구간의 상행역`과 `신규 노선의 하행역`이 일치할 경우 `새로운 역을 상행 종점`으로 등록 case
   4. `새로운 역을 하행 종점`으로 등록할 경우
      1. 기존역 A-C (7m), 새로운 역 C-B (3m)
      2. 이 경우 A-C-B 가 되며
      3. 각 구간의 길이는 A-C (7m), C-B (3m) 가 된다.
      4. `기존 구간의 하행역`과 `신규 노선의 상행역`이 일치할 경우 `새로운 역을 하행 종점`으로 등록 case
   5. 노선 조회시 응답되는 역 목록 수정
      1. 구간이 저장되는 순서로 역 목록을 조회할 경우 순서가 다르게 조회될 수 있음!
      2. 아래의 순서대로 역 목록을 응답하는 로직을 변경해야 함
         1. `상행 종점이 상행역`인 구간을 먼저 찾는다.
         2. 그 다음, `해당 구간의 하행역이 상행역인 다른 구간`을 찾는다.
         3. 2번을 반복하다가 `하행 종점역을 찾으면 조회`를 멈춘다.
   6. 예외 케이스
      1. `역 사이에 새로운 역을 등록`할 경우 기존 역 사이 `길이보다 크거나 같으면` 등록할 수 없음
      2. `상행역과 하행역이 이미 노선에 모두 등록`되어 있다면 추가할 수 없음
      3. `상행역과 하행역 둘 중 하나도 포함되어있지 않으면` 추가할 수 없음